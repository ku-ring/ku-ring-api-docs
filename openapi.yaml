openapi: 3.0.1
info:
  title: Kuring API
  version: v2
  description: Kuring 서비스 API 명세서

# 1. 보안 설정 (전역)
components:
  securitySchemes:
    UserTokenAuth:
      type: apiKey
      in: header
      name: User-Token
    BearerAuth:
      type: http
      scheme: bearer
      
tags:
  - name: User
    description: 사용자 관련 API (로그인, 정보, 구독 등)
  - name: Notice
    description: 공지사항 관련 API
  - name: Admin
    description: 관리자 전용 API

# 2. API 경로 정의
paths:
  # ------------------------------------------------------------------
  # [로그인/인증]
  # ------------------------------------------------------------------
  /api/v2/users/login:
    post:
      tags: [User]
      summary: 사용자 로그인
      operationId: login
      security:
        - UserTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserLoginRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        $ref: './components/schemas/user/UserLoginResponse.yaml'

  /api/v2/users/logout:
    post:
      tags: [User]
      summary: 사용자 로그아웃
      operationId: logout
      security:
        - UserTokenAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/users/signup:
    post:
      tags: [User]
      summary: 사용자 회원가입
      operationId: signup
      security:
        - UserTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserSignupRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/users/withdraw:
    delete:
      tags: [User]
      summary: 사용자 회원 탈퇴
      operationId: withdraw
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/users/password:
    patch:
      tags: [User]
      summary: 사용자 비밀번호 변경
      operationId: modifyPassword
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserPasswordModifyRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  # ------------------------------------------------------------------
  # [사용자 정보]
  # ------------------------------------------------------------------
  /api/v2/users/user-me:
    get:
      tags: [User]
      summary: 사용자 정보 조회
      operationId: lookupUserInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        $ref: './components/schemas/user/UserInfoResponse.yaml'

  /api/v2/users/ask-counts:
    get:
      tags: [User]
      summary: 사용자 질문 가능횟수 조회
      operationId: lookupUserAIAskCount
      security:
        - UserTokenAuth: []
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        $ref: './components/schemas/user/UserAIAskCountResponse.yaml'

  # ------------------------------------------------------------------
  # [구독 및 알림]
  # ------------------------------------------------------------------
  /api/v2/users/subscriptions/departments:
    get:
      tags: [User]
      summary: 사용자 학과 조회
      operationId: lookupUserSubscribeDepartments
      security:
        - UserTokenAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: './components/schemas/user/UserDepartmentNameResponse.yaml'
    post:
      tags: [User]
      summary: 사용자 학과 수정
      operationId: editUserSubscribeDepartments
      security:
        - UserTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserDepartmentsSubscribeRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/users/subscriptions/categories:
    get:
      tags: [User]
      summary: 사용자 카테고리 조회
      operationId: lookupUserSubscribeCategories
      security:
        - UserTokenAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: './components/schemas/user/UserCategoryNameResponse.yaml'
    post:
      tags: [User]
      summary: 사용자 카테고리 수정
      operationId: editUserSubscribeCategories
      security:
        - UserTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserCategoriesSubscribeRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/users/notifications/academic-events:
    patch:
      tags: [User]
      summary: 사용자 학사일정 알림 설정 수정
      operationId: updateAcademicEventNotification
      security:
        - UserTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserAcademicEventNotificationRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  # ------------------------------------------------------------------
  # [기타 기능]
  # ------------------------------------------------------------------
  /api/v2/users/feedbacks:
    post:
      tags: [User]
      summary: 사용자 피드백 작성
      operationId: saveFeedback
      security:
        - UserTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserFeedbackRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/users/bookmarks:
    get:
      tags: [User]
      summary: 사용자 북마크 조회
      operationId: lookupUserBookmarks
      security:
        - UserTokenAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: './components/schemas/user/UserBookmarkResponse.yaml'
    post:
      tags: [User]
      summary: 사용자 북마크 작성
      operationId: saveBookmark
      security:
        - UserTokenAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/user/UserBookmarkRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'
  # ------------------------------------------------------------------
  # [공지사항] Notice
  # ------------------------------------------------------------------
  /api/v2/notices:
    get:
      tags: [Notice]
      summary: 공지사항 목록 조회
      description: 특정 학과나 카테고리의 공지사항 목록을 조회합니다.
      operationId: getNotices
      parameters:
        - name: type
          in: query
          description: 조회 타입 (school=학교공지, dep=학과공지)
          required: true
          schema:
            type: string
            enum: [school, dep]
            example: "dep"
        - name: department
          in: query
          description: 학과 코드 (type이 dep일 때 필수)
          schema:
            type: string
            example: "computer_cse"
        - name: category
          in: query
          description: 카테고리 (type이 school일 때 필수)
          schema:
            type: string
            example: "bachelor"
        - name: page
          in: query
          description: 페이지 번호 (0부터 시작)
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          description: 페이지 크기
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        $ref: './components/schemas/notice/NoticeListResponse.yaml'

  /api/v2/notices/search:
    get:
      tags: [Notice]
      summary: 공지사항 키워드 검색
      operationId: searchNotices
      parameters:
        - name: content
          in: query
          description: 검색할 키워드 (공백으로 구분)
          required: true
          schema:
            type: string
            example: "장학금 수강신청"
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        $ref: './components/schemas/notice/NoticeListResponse.yaml'

  /api/v2/notices/departments:
    get:
      tags: [Notice]
      summary: 공지 조회 지원 학과 목록
      operationId: getNoticeDepartments
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        $ref: './components/schemas/notice/NoticeDepartmentListResponse.yaml'

  /api/v2/notices/categories:
    get:
      tags: [Notice]
      summary: 공지 조회 지원 카테고리 목록
      operationId: getNoticeCategories
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        $ref: './components/schemas/notice/NoticeCategoryListResponse.yaml'

  # ------------------------------------------------------------------
  # [공지사항 댓글] Notice Comments
  # ------------------------------------------------------------------
  /api/v2/notices/{articleId}/comments:
    get:
      tags: [Notice]
      summary: 공지사항 댓글 조회
      operationId: getNoticeComments
      parameters:
        - name: articleId
          in: path
          required: true
          description: 게시글 ID
          schema:
            type: string
            example: "56281"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: './components/schemas/notice/NoticeCommentDto.yaml'
    post:
      tags: [Notice]
      summary: 공지사항 댓글 작성
      operationId: createNoticeComment
      security:
        - UserTokenAuth: []
      parameters:
        - name: articleId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/notice/NoticeCommentRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/notices/{articleId}/comments/{commentId}:
    post:
      tags: [Notice]
      summary: 공지사항 댓글 수정
      description: "주의: REST 표준(PATCH)이 아닌 POST 메서드를 사용합니다."
      operationId: updateNoticeComment
      security:
        - UserTokenAuth: []
      parameters:
        - name: articleId
          in: path
          required: true
          schema:
            type: string
        - name: commentId
          in: path
          required: true
          description: 수정할 댓글 ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/notice/NoticeCommentRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'
    delete:
      tags: [Notice]
      summary: 공지사항 댓글 삭제
      operationId: deleteNoticeComment
      security:
        - UserTokenAuth: []
      parameters:
        - name: articleId
          in: path
          required: true
          schema:
            type: string
        - name: commentId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'
  # ------------------------------------------------------------------
  # [관리자] Admin
  # ------------------------------------------------------------------
  /api/v2/admin/notices/prod:
    post:
      tags: [Admin]
      summary: 실제 공지사항 전송 (Prod)
      description: 앱 사용자 전체에게 푸시 알림과 함께 공지를 등록합니다.
      operationId: createProdNotice
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/admin/AdminNoticeRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/admin/notices/dev:
    post:
      tags: [Admin]
      summary: 테스트 공지사항 전송 (Dev)
      description: 개발 서버 혹은 테스터에게만 공지를 전송합니다.
      operationId: createDevNotice
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/admin/AdminNoticeRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/admin/users/subscriptions/all:
    post:
      tags: [Admin]
      summary: 사용자 전체 재구독 처리
      description: 모든 사용자의 구독 정보를 갱신합니다. (비상용)
      operationId: refreshAllSubscriptions
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/admin/alerts:
    get:
      tags: [Admin]
      summary: 예약 알림 목록 조회
      operationId: getAdminAlerts
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: './components/schemas/admin/AdminAlertDto.yaml'
    post:
      tags: [Admin]
      summary: 예약 알림 등록
      operationId: createAdminAlert
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components/schemas/admin/AdminAlertRequest.yaml'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/admin/alerts/{id}:
    delete:
      tags: [Admin]
      summary: 예약 알림 취소/삭제
      operationId: deleteAdminAlert
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/admin/whitelist-words/reload:
    post:
      tags: [Admin]
      summary: 허용 단어 사전 리로드
      operationId: reloadWhitelist
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/admin/badwords/reload:
    post:
      tags: [Admin]
      summary: 금칙어 사전 리로드
      operationId: reloadBadwords
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: './components/schemas/common/BaseResponse.yaml'

  /api/v2/admin/reports:
    get:
      tags: [Admin]
      summary: 신고 목록 조회
      operationId: getReports
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: './components/schemas/admin/AdminReportResponse.yaml'

  /api/v2/admin/feedbacks:
    get:
      tags: [Admin]
      summary: 피드백 목록 조회
      operationId: getFeedbacks
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './components/schemas/common/BaseResponse.yaml'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: './components/schemas/admin/AdminFeedbackResponse.yaml'